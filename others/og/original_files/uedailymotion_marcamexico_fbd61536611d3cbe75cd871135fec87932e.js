(()=>{"use strict";const e=Object.freeze({players:{autoplay:"xnri4",autoplay_loop:"xnri7",no_autoplay:"xnri6"},advertisement:{iuId:"99071977",androidAdUnitId:"mc-mx-mv-android",iOSAdUnitId:"mc-mx-mv-ios",desktopAdUnitId:"mc-mx",defaultIU:"mc-mx/marca_videocort_videos",nonPersonalizedIU:"nopurpose",aps:!1,apsConfig:{pubID:3537,videoAdServer:"DFP",bidTimeout:1e3,slotID:"videoSlotName1",mediaType:"video",apsScriptInPage:!0,apsInitInPage:!0,apsVariable:"ueApstagInit",apsEvent:"ueApstagInit",apsUeInitTimeout:2e3},adTagOtherParams:"ad_rule=0&sz=640x360",externalAdvertisement:{active:!0,externalConfig:{US:{externalNetworkId:"22904114906"},"AR,CO,CL,MX,PE,AG,AW,BB,BZ,KY,CR,DM,DO,SV,GF,GD,GP,GT,HT,HN,JM,NI,PA,PR,BS,BO,BR,EC,PY,UY,VE":{externalNetworkId:"21756062855"}}}},autoplayFrequency:{session:!1,maxVideos:50,delta:86400,maxCount:1},defaultPlayerSettings:{autoplay:!1,pip:!1,defaultLibPlayerId:"xnri6"},defaultMute:!1,manageConsent:!0,migrationActive:!1,migrationServiceURL:"https://www.marca.com/edge-services/api/video/idlist.html?videoId=",geoServiceURL:"https://www.marca.com/edge-services/user-geo.html",ueDataLayergeo:"country",rules:{onlyOneAutoplay:!0}}),t=Object.freeze({consent:{consentLocalStorage:"ueConsentData",IAB_GOOGLE_VENDOR:755,IAB_DMOTION_VENDOR:573,consentAmpCookieName:"AMP-CONSENT"},events:{dailymotionConsentChecked:"ueDailymotionConsentChecked",dailymotionLibReady:"ueDailymotionReady",ueConsentChanged:"ueConsentChanged",allowedEventListeners:"VIDEO_END",eventsToAnalytics:["AD_END","AD_START","PLAYER_CRITICALPATHREADY","PLAYER_END","PLAYER_START","PLAYER_VOLUMECHANGE","VIDEO_END","VIDEO_PAUSE","VIDEO_PLAY","VIDEO_START","VIDEO_TIMECHANGE","PLAYER_PRESENTATIONMODECHANGE"],videoEndDispatchEvent:"UEDailyMotionVideoEnd",playerStartDispatchEvent:"videoPlayerReady",prebidEvent:"AD_READYTOFETCH",prebidPlayerEndEvent:"PLAYER_END",videoTimeChange_counter_delay:8,geoServiceResult:"ueDailymotionGeoService"},frequency:{frequencyStorage:"ueVideoFreq",frequencyListStorage:"ueVideoFreqList"},dev_log_param:"dmotion",dev_log_customization:"color:tomato;background:#d9f929",scaleMode:"fit,fill,fillLeft,fillRight,fillTop,fillBottom",playerNameFields:[{field:"autoplay",priority:2,always_present:!0},{field:"pip",priority:3,always_present:!1},{field:"loop",priority:4,always_present:!1},{field:"cover",priority:1,always_present:!1}],dmotionLibUrl:"https://geo.dailymotion.com/libs/player/"});var i=(()=>{const e=window.localStorage?.getItem("ue-dcv")||window.localStorage?.getItem("ue-dcv-"+t.dev_log_param),i={};return["debug","error","info","log","warn","dir","dirxml","table","trace","group","groupCollapsed","groupEnd","clear","count","countReset","assert","profile","profileEnd","time","timeLog","timeEnd","timeStamp","context","memory"].forEach((e=>{i[e]=window.console[e]||function(){}})),e||Object.keys(console).forEach((e=>i[e]=()=>{})),i})();class n{apsInitialized;constructor(){this.bidsString="",e&&e.advertisement?.apsConfig&&"object"==typeof e.advertisement.apsConfig&&(this.apsConfig=e.advertisement.apsConfig),this.apsInitialized=!1}checkAPSConfigParams(){return!!(this.apsConfig.hasOwnProperty("pubID")&&this.apsConfig.hasOwnProperty("videoAdServer")&&this.apsConfig.hasOwnProperty("bidTimeout")&&this.apsConfig.hasOwnProperty("slotID")&&this.apsConfig.hasOwnProperty("mediaType"))}resetBidsString(){this.bidsString=""}getAPSBids(){return this.bidsString}handleAPSVideoBids(e){var n="";if(i.log("%c DMOTION: APS Prebid bidsString:"+JSON.stringify(e),t.dev_log_customization),e.length>0){for(var o=0;o<e.length;o++)e[o].helpers&&e[o].helpers.qsParams?n+=e[o].helpers.qsParams():e[o].qsParams&&(n+=e[o].qsParams);this.bidsString=n}}async amazonPreBid(){const e=new Promise(((e,t)=>{setTimeout((()=>{e(!1)}),this.apsConfig.bidTimeout)})),n=new Promise(((e,n)=>{try{i.log("%c DMOTION: APS Prebid starting:",t.dev_log_customization),this.resetBidsString(),this.checkAPSConfigParams()&&window.apstag&&this.apsInitialized?window.apstag.fetchBids({slots:[{slotID:this.apsConfig.slotID,mediaType:this.apsConfig.mediaType}],timeout:this.apsConfig.bidTimeout},(t=>{this.handleAPSVideoBids(t),e(!0)})):(i.log("%c DMOTION: Error Amazon Aps config parameters or Amazon APS not initialized:",t.dev_log_customization),e(!1))}catch(n){i.log("%c DMOTION: Error catch Amazon Aps config parameters or Amazon APS not initialized:",t.dev_log_customization),e(!1)}}));return Promise.race([e,n])}async manageAPSUELoad(n,o){const a=new Promise(((e,t)=>{setTimeout((()=>{e(!1)}),this.apsConfig.apsUeInitTimeout||2e3)})),s=new Promise(((a,s)=>{if(this.apsConfig.apsScriptInPage||window.apstag||function(e,t,i,n,o,a,s){function r(i,n){t[e]._Q.push([i,n])}t[e]||(t[e]={init:function(){r("i",arguments)},fetchBids:function(){r("f",arguments)},setDisplayBids:function(){},targetingKeys:function(){return[]},_Q:[]},(a=i.createElement(n)).async=!0,a.src="//c.amazon-adsystem.com/aax2/apstag.js",(s=i.getElementsByTagName(n)[0]).parentNode.insertBefore(a,s))}("apstag",window,document,"script"),this.apsConfig.apsInitInPage)this.apsConfig.apsVariable&&this.apsConfig.apsEvent?!0===window[this.apsConfig.apsVariable]?(i.log("%c DMOTION: APS Prebid already initialitaded",t.dev_log_customization),this.apsInitialized=!0,a(!0)):document.addEventListener(this.apsConfig.apsEvent,(()=>{i.log("%c DMOTION: APS Prebid EVENT LISTNER initialitaded",t.dev_log_customization),this.apsInitialized=!0,a(!0)})):(this.apsInitialized=!0,a(!0));else{if(this.checkAPSConfigParams()&&window.apstag){let t=this.apsConfig.pubID;if(o&&e.advertisement.externalAdvertisement.externalConfig&&e.advertisement.externalAdvertisement.externalConfig[o]){let i=e.advertisement.externalAdvertisement.externalConfig[o];i&&i.apsExternalPubID&&(t=i.apsExternalPubID)}apstag.init({pubID:t,videoAdServer:this.apsConfig.videoAdServer,bidTimeout:this.apsConfig.bidTimeout,gdpr:{enabled:Boolean(n),consent:n},deals:!0})}this.apsInitialized=!0,a(!0)}}));return Promise.any([a,s])}}class o{PERMUTIVE_MAX_SEGMENTS=90;section="";cust_params;videoOptions;specialFormat;constructor(e,t){this.defaultAdvConfig=e,this.consentManager=t,this.apsManager=new n,this.adTagUrl="",this.cust_params=new Map,this.device=this.isMobile.any()?"mobile":"desktop",this.iu="",this.specialFormat=!1,this.isFirstPreroll=!0,this.isFirstPostroll=!0,this.externalAdCountries=""}setAdvConfig(e){this.videoOptions=e}setTags(e){this.cust_params.set("tag",e)}setTopic(e){this.cust_params.set("t",e)}setSection(e){this.section=e}setSpecialFormat(e){e&&(this.specialFormat=!0)}getSegFromPermutive(){let e=this.PERMUTIVE_MAX_SEGMENTS;try{var t=encodeURIComponent(JSON.parse(window.localStorage._pdfps||"[]").slice(0,e).toString());this.cust_params.set("permutive",t)}catch(e){}}getAutoplayAdvInfo(){this.videoOptions&&!0===this.videoOptions.autoplay?this.cust_params.set("autoplay","true"):this.cust_params.set("autoplay","false"),this.videoOptions&&!0===this.videoOptions.isAdHome&&this.cust_params.set("homeAutoplay","true")}isAmazonApsEnabled(){return!(!this.defaultAdvConfig||"object"!=typeof this.defaultAdvConfig||!this.defaultAdvConfig.hasOwnProperty("aps"))&&!0===this.defaultAdvConfig.aps}getCustParamsString(){let e="";if(this.cust_params.forEach(((t,i)=>{""!==e&&(e+="&"),e+=i+"="+t})),this.isAmazonApsEnabled()){let t=this.apsManager.getAPSBids();""!==t&&(e+=t)}return e}getCustParamValue(e){return this.cust_params.get(e)}async refreshAdvWithPrebid(n,o){if(i.log("%c DMOTION: Refresh Ad Config STATE value"+JSON.stringify(o)+"date:"+new Date,t.dev_log_customization),o&&"preroll"===o.adPosition&&this.isFirstPreroll)return i.log("%c DMOTION: Refresh Ad Config  preroll detected doing nothing",t.dev_log_customization),void(this.isFirstPreroll=!1);if(o&&null===o.adPosition)return void i.log("%c DMOTION: Refresh Ad Config  without adPosition  doing nothing",t.dev_log_customization);let a,s=e.manageConsent;if(s&&(a=this.consentManager.checkGoogleConsent()),s&&(!a||-1===a)||this.specialFormat)i.log("%c DMOTION: Refresh Ad no needs to update advertisement",t.dev_log_customization);else{this.isAmazonApsEnabled()&&await this.manageGDPRAmazonPreBid();let e=this.getDmotionAdConfig(o);e&&""!=e.dynamiciu&&n.setCustomConfig(e),i.log("%c DMOTION: Refresh Ad Config in AD_READY_TO_FETCH"+JSON.stringify(e)+"date:"+new Date,t.dev_log_customization)}}async manageGDPRAmazonPreBid(e){if(this.isAmazonApsEnabled()){if(e){let e=this.consentManager.checkGoogleConsent();if(!e||-1===e)return!1}return this.apsManager.amazonPreBid()}return!1}async manageGDPRAmazonPrebidLoad(e){if(e){let e=this.consentManager.checkGoogleConsent();if(!e||-1===e)return!1}let t=this.consentManager.getConsentDataFromStorage();return this.apsManager.manageAPSUELoad(t,this.externalAdCountries)}isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()}};generateIu(e){var t="";let i=e.iuId;if(""!==this.externalAdCountries&&e.externalAdvertisement&&e.externalAdvertisement.externalConfig){let t=e.externalAdvertisement.externalConfig[this.externalAdCountries];t&&t.externalNetworkId&&(i=t.externalNetworkId+","+i)}if(""!==this.section||"mobile"==this.device){let n,o=this.isMobile.Android()?"android":"ios";n="mobile"==this.device?"android"==o?e.androidAdUnitId:e.iOSAdUnitId:e.desktopAdUnitId,t="/"+i+"/"+n,t=""!=this.section?t+"/"+this.section:t,t+="/vc"}else t="/"+i+"/"+e.defaultIU;return t}async getUserCountry(){if(window.ueGaclKaltura)return window.ueGaclKaltura;if(e.ueDataLayergeo&&window.ueDataLayer&&window.ueDataLayer[e.ueDataLayergeo])return window.ueDataLayer[e.ueDataLayergeo];if(window.ueGaclDmotion)return window.ueGaclDmotion;if(!e.geoServiceURL||window.ueGaclDmotionInProgress)return t&&t.events&&t.events.geoServiceResult?new Promise(((e,i)=>{document.addEventListener(t.events.geoServiceResult,(t=>{t&&t.detail&&t.detail.geo&&e(t.detail.geo),e("")}))})):(i.log("%c DMOTION: Configuration Error in geoService, no ad geo for the video: ",t.dev_log_customization),"");try{window.ueGaclDmotionInProgress=!0;const n=await fetch(e.geoServiceURL);if(!n.ok){if(i.log("%c DMOTION: geoService response not ok:",t.dev_log_customization),window.ueGaclDmotion="ES",t&&t.events&&t.events.geoServiceResult){let e=new CustomEvent(t.events.geoServiceResult,{detail:{geo:""}});document.dispatchEvent(e)}return""}const o=await n.json();if(o.iso||o.country_code){let e=o.iso||o.country_code;if(window.ueGaclDmotion=e,t&&t.events&&t.events.geoServiceResult){let i=new CustomEvent(t.events.geoServiceResult,{detail:{geo:e}});document.dispatchEvent(i)}return e}return""}catch(e){if(i.log("%c DMOTION:Error in geoService: "+e,t.dev_log_customization),window.ueGaclDmotion="",t&&t.events&&t.events.geoServiceResult){let e=new CustomEvent(t.events.geoServiceResult,{detail:{geo:""}});document.dispatchEvent(e)}return""}}async getAdExternalCountries(e){if(e.externalAdvertisement&&e.externalAdvertisement.active&&"object"==typeof e.externalAdvertisement.externalConfig){let o=await this.getUserCountry();i.log("%c DMOTION: geoService GIVE US USER:"+o,t.dev_log_customization);let a=Object.keys(e.externalAdvertisement.externalConfig);for(var n=0;n<a.length;n++){let e=a[n];if(e.split(",").filter((e=>e===o)).length>0)return e}}return""}generateNonPersonalizedIU(e){let t="";if(e.nonPersonalizedIU){let i,n=this.isMobile.Android()?"android":"ios";i="mobile"==this.device?"android"==n?e.androidAdUnitId:e.iOSAdUnitId:e.desktopAdUnitId;let o=e.iuId;if(""!==this.externalAdCountries&&e.externalAdvertisement&&e.externalAdvertisement.externalConfig){let t=e.externalAdvertisement.externalConfig[this.externalAdCountries];t&&t.externalNetworkId&&(o=t.externalNetworkId+","+o)}t="/"+o+"/"+i,t=t+"/"+e.nonPersonalizedIU,t+="/vc"}return t}getDescriptionUrl=function(e){let t=location.protocol+"//"+location.host+location.pathname;return encodeURIComponent(t)};async _processPublicidad(e){if(void 0!==this.defaultAdvConfig){let n,o=this.defaultAdvConfig||{},a={};if(e&&(n=this.consentManager.checkGoogleConsent()),o.externalAdvertisement&&!0===o.externalAdvertisement.active){let e=await this.getAdExternalCountries(o);e&&""!=e&&(this.externalAdCountries=e,this.adExternalOtherParams=this.checkExternalAdOtherParams(o))}if(!e||n&&-1!==n)if(this.specialFormat)a=this.getDmotionAdConfig();else{if(this.isAmazonApsEnabled())try{let e=await this.manageGDPRAmazonPrebidLoad();e?i.log("%c DMOTION: CALLING TIMING PREBID IN PROCESSPUBLICIDAD ",t.dev_log_customization):i.log("%c DMOTION: PREBID TIMEOUT value promise:"+e,t.dev_log_customization)}catch(e){i.log("%c DMOTION: Prebid exception"+e)}this.iu=this.generateIu(o),this.getSegFromPermutive(),this.getAutoplayAdvInfo()}else this.iu=this.generateNonPersonalizedIU(o),a=this.getDmotionAdConfig();return a}return{}}getDmotionAdConfig(t){let i={},n=this.getCustParamsString();i.dynamiciu=this.iu,i.keyvalues=n,i.otherparams=e.advertisement?.adTagOtherParams||"",this.adExternalOtherParams&&(i.otherparams=this.adExternalOtherParams);let o=1;this.getCustParamValue("homeAutoplay")&&(o=2),i.otherparams+="&plcmt="+o;let a=0;return t?!0===t.playerIsMuted&&(a=1):this.videoOptions&&!0===this.videoOptions.mute&&(a=1),i.otherparams+="&vpmute="+a,this.consentManager.isConsentManagedAmpForAdvertisement()&&""!==this.consentManager.getAmpConsentString()&&(i.otherparams+="&gdpr_consent="+this.consentManager.getAmpConsentString()),!0===this.specialFormat&&(i.premium=!0),i}checkExternalAdOtherParams(e){if(""!==this.externalAdCountries&&e.externalAdvertisement&&e.externalAdvertisement.externalConfig){let t=e.externalAdvertisement.externalConfig[this.externalAdCountries];if(t&&t.externalAdTagOtherParams)return t.externalAdTagOtherParams}return""}}class a{constructor(){if(!t.frequency?.frequencyStorage||!t.frequency?.frequencyListStorage)throw new Exception("Error in configuration. No parameters defined for frequency");this.frequencyStorage=t.frequency.frequencyStorage,this.frequencyListStorage=t.frequency.frequencyListStorage}checkStorageAllowed(){try{let e="ueVideo_check",t="ueVideo_test";window.localStorage.setItem(e,t);let i=window.localStorage.getItem(e);return window.localStorage.removeItem(e),i===t}catch(e){return!1}}createFrequencyEntry(){return{date:Math.floor(Date.now()/1e3),counter:1}}checkAllowedAutoplayFrequency(e,n,o){if(this.checkStorageAllowed()&&this.frequencyStorage&&n.autoplayFrequency&&n.autoplayFrequency.hasOwnProperty("session")&&n.autoplayFrequency.hasOwnProperty("maxVideos")&&n.autoplayFrequency.hasOwnProperty("delta")){let a=o?e+"_"+o:e;if(a.replaceAll(",",""),"boolean"==typeof n.autoplayFrequency.session&&"number"==typeof n.autoplayFrequency.maxVideos&&"number"==typeof n.autoplayFrequency.delta){let e,t;this.checkStorageIntegrity(),e=this.getFrequencyStorage(this.frequencyStorage,n.autoplayFrequency.session);try{t=JSON.parse(e),t||(t={});let i=t[a];if(i){if(n.autoplayFrequency.delta){let e=Math.floor(Date.now()/1e3);if(i.date&&n.autoplayFrequency.delta+i.date<e)return t[a]=this.createFrequencyEntry(),this.setFrequencyStorage(this.frequencyStorage,JSON.stringify(t),n.autoplayFrequency.session),!0}return!!(n.autoplayFrequency.maxCount&&i.counter<n.autoplayFrequency.maxCount)&&(t[a].counter+=1,this.setFrequencyStorage(this.frequencyStorage,JSON.stringify(t),n.autoplayFrequency.session),!0)}return t[a]=this.createFrequencyEntry(),this.addEntryInFrequencyStorage(a,t,n.autoplayFrequency.maxVideos,n.autoplayFrequency.session),!0}catch(e){return!1}}else i.log("%c DMOTION: Error in frequency config",t.dev_log_customization)}else i.log("%c DMOTION:Error in portal frequency config definition or not storage allowed",t.dev_log_customization);return!0}addEntryInFrequencyStorage(e,t,i,n){if(e&&t&&i){let o,a=this.getFrequencyStorage(this.frequencyListStorage,n);if(o=a?a.split(","):[],o.length>=i){let e=o.length-i+1;for(let i=0;i<e;i++)delete t[o.shift()]}o.push(e),this.setFrequencyStorage(this.frequencyListStorage,o.join(","),n),this.setFrequencyStorage(this.frequencyStorage,JSON.stringify(t),n)}}getFrequencyStorage=function(e,t){return t?window.sessionStorage.getItem(e):window.localStorage.getItem(e)};setFrequencyStorage=function(e,t,i){i&&window.sessionStorage.setItem(e,t),window.localStorage.setItem(e,t)};removeFrequencyStorage=function(e,t){t&&window.sessionStorage.removeItem(e),window.localStorage.removeItem(e)};checkStorageIntegrity=function(e){let t=!1,i=this.getFrequencyStorage(this.frequencyListStorage,e),n=this.getFrequencyStorage(this.frequencyStorage,e);(null!==i&&null===n||null===i&&null!==n)&&(t=!0);try{JSON.parse(n)}catch(e){t=!0}t&&(this.removeFrequencyStorage(this.frequencyListStorage,e),this.removeFrequencyStorage(this.frequencyStorage,e))}}class s{constructor(){this.videoInfo={}}setUpDmotionAnalytics(e,n,o){if(!e)return i.log("%c DMOTION: Error trying to set analytics events without dmotion player instance received ",t.dev_log_customization),null;let a=0;for(let s=0;s<t.events?.eventsToAnalytics.length;s++){let r=t.events?.eventsToAnalytics[s];dailymotion.events&&dailymotion.events[r]&&e.on(dailymotion.events[r],(s=>{if("VIDEO_TIMECHANGE"===r&&t.events?.videoTimeChange_counter_delay&&"number"==typeof t.events?.videoTimeChange_counter_delay){if(a++,a!=t.events.videoTimeChange_counter_delay)return;a=0}if("VIDEO_END"===r&&t.events?.videoEndDispatchEvent){let i=new CustomEvent(t.events.videoEndDispatchEvent,{detail:{player:e}});window.dispatchEvent(i)}if("PLAYER_START"===r&&t.events?.playerStartDispatchEvent){let e=new CustomEvent(t.events.playerStartDispatchEvent,{detail:{playerId:n}});window.dispatchEvent(e)}if("PLAYER_START"===r||"AD_START"===r||"VIDEO_PLAY"===r)try{let e=s.videoId;if(e&&"PLAYER_START"===r&&(this.videoInfo[e]={},this.videoInfo[e].initTime=(new Date).getTime()),e&&"AD_START"===r&&!this.videoInfo[e].adTimeSended&&(this.videoInfo[e].adTime=(new Date).getTime(),this.videoInfo[e].initTime)){let t=this.videoInfo[e].adTime-this.videoInfo[e].initTime;this.videoInfo[e].waitAdTime=t,s.waitAdTime=t}if(e&&"VIDEO_PLAY"===r&&!this.videoInfo[e].adTimeSended){if(!this.videoInfo[e].waitAdTime&&this.videoInfo[e].initTime){let t=(new Date).getTime()-this.videoInfo[e].initTime;s.waitNoAdTime=t}else this.videoInfo[e].waitAdTime&&(s.waitAdTime=this.videoInfo[e].waitAdTime);this.videoInfo[e].adTimeSended=!0}}catch(e){}if("function"==typeof window.setDMData){if("object"==typeof o&&Object.keys(o).length>0)for(let e in o)s[e]=o[e];i.log("%c DMOTION event: "+r+"date:"+new Date,t.dev_log_customization),i.log("%c DMOTION info: "+JSON.stringify(s),t.dev_log_customization),window.setDMData(s,r)}}))}}setDMotionDynamicPrebid(e,n,o){let a=t.events?.prebidEvent;if(!(e&&a&&dailymotion.events[a]&&n))return null;if(e.on(dailymotion.events[a],(t=>{n.refreshAdvWithPrebid(e,t)})),o&&o.playlist&&""!==o.playlist){i.log("%c DMOTION playlist param detected, PLAYER_END associated to ask prebid for preroll",t.dev_log_customization);let o=t.events?.prebidPlayerEndEvent;e.on(dailymotion.events[o],(t=>{n.refreshAdvWithPrebid(e,t)}))}}setEventsCallbacks(e,n){if(!e)return i.log("%c DMOTION: Error trying to set analytics events without dmotion player instance received",t.dev_log_customization),null;if(Object.keys(n).length>0)for(let t=0;t<Object.keys(n).length;t++){let i=Object.keys(n)[t],o=n[i];"VIDEO_END"===i&&e.on(dailymotion.events.PLAYER_END,(e=>{o()}))}}}class r{userGoogleConsent="";userDmotionConsent="";consentChecked=!1;consentManaged=!1;consentChangedChecked=!1;manageAmpConsentInAdvertisement=!1;ampConsentString="";constructor(e){e&&e.manageConsent&&(this.consentManaged=!0),e&&e.manageAmpConsentInAdvertisement&&(this.manageAmpConsentInAdvertisement=!0)}getConsentDataFromStorage(){return t.consent?.consentLocalStorage?localStorage.getItem(t.consent.consentLocalStorage):""}isConsentManaged(){return this.consentManaged}isConsentManagedAmpForAdvertisement(){return this.manageAmpConsentInAdvertisement}getAmpConsentString(){return this.ampConsentString}async checkDMotionConsent(){return new Promise(((e,i)=>{window.onPolicyReady=window.onPolicyReady||[],window.onPolicyReady.push((async()=>{const i=window.ueCookiesPolicy;if(t.consent?.IAB_DMOTION_VENDOR){const n=await i.promise(i.getUserConsentStatusForVendor.bind(i,t.consent?.IAB_DMOTION_VENDOR));if(void 0!==n)return this.userDmotionConsent=n,void e(n);this.consentChangedChecked||(this.consentChangedChecked=!0,t.events?.ueConsentChanged&&window.addEventListener(t.events?.ueConsentChanged,(async()=>{const n=await i.promise(i.getUserConsentStatusForVendor.bind(i,t.consent?.IAB_DMOTION_VENDOR));this.userDmotionConsent=n,e(n)})))}}))}))}async manageUserInteractConsent(){if(!this.consentChecked){if(await this.checkDMotionConsent(),this.consentChecked=!0,!t.events?.dailymotionConsentChecked)throw new Error("Error configuration dailymotionConsentChecked value expected");{const e=new CustomEvent(t.events?.dailymotionConsentChecked);document.dispatchEvent(e)}return this.consentChecked}return this.consentChecked}async manageAmpConsentFromGoogleDomain(){if(!this.consentChecked){if(await this.checkAmpConsent(),this.consentChecked=!0,!t.events?.dailymotionConsentChecked)throw new Error("Error configuration dailymotionConsentChecked value expected");{const e=new CustomEvent(t.events?.dailymotionConsentChecked);document.dispatchEvent(e)}return this.consentChecked}return this.consentChecked}async checkAmpConsent(){if(t?.consent?.consentAmpCookieName){if(-1!==document.cookie.indexOf(t.consent.consentAmpCookieName))return!0;{const e=new Promise(((e,t)=>{setTimeout((()=>{e(!1)}),2e3)})),t=new Promise(((e,t)=>{let i=t=>{t&&t.data&&t.data.sentinel&&"amp"==t.data.sentinel&&t.data.consentString&&(window.removeEventListener("message",i),this.ampConsentString=t.data.consentString,e(t.data.consentString))};window.addEventListener("message",i),window.parent.postMessage({sentinel:"amp",type:"send-consent-data"},"*")}));return Promise.race([e,t])}}return!1}async checkUserInteractConsent(){return new Promise(((e,n)=>{if(this.consentChecked&&e(this.consentChecked),!t.events?.dailymotionConsentChecked)throw new Error("Error configuration dailymotionConsentChecked value expected");i.log("%c DMOTION:[consent] waiting for user interaction",t.dev_log_customization),document.addEventListener(t.events?.dailymotionConsentChecked,(n=>{i.log("%c DMOTION:[consent] user interact with consent",t.dev_log_customization),e(this.consentChecked)}))}))}checkGoogleConsent(){return""!==this.userGoogleConsent?(i.log("%c DMOTION: storaged googleUser consent:"+this.userGoogleConsent,t.dev_log_customization),this.userGoogleConsent):(!window.ueCookiesPolicy||"object"==typeof window.ueCookiesPolicy&&"function"!=typeof window.ueCookiesPolicy.getUserConsentStatusForVendor?this.userGoogleConsent=-1:t?.consent.IAB_GOOGLE_VENDOR?this.userGoogleConsent=window.ueCookiesPolicy.getUserConsentStatusForVendor(t?.consent.IAB_GOOGLE_VENDOR):this.userGoogleConsent=void 0,i.log("%c DMOTION: googleUser consent:"+this.userGoogleConsent,t.dev_log_customization),this.userGoogleConsent)}}class d{isDMotionLibLoaded=!1;defaultPlayerId="";config={};existPipPlayerInPage=!1;constructor(t){this.config=e,this.consentManager=new r(this.config),this.frequencyManager=new a,this.eventsManager=new s,this.loadDmotionLibrary(),this.onReadyCallbacks=t||[]}onReady={push(e){"function"==typeof e?e.apply(this,arguments):console.log("[Dmotion] onReady.push: Error You must provide a function")}};init(){this.consentManager.isConsentManaged()?this.consentManager.manageUserInteractConsent():this.consentManager.isConsentManagedAmpForAdvertisement()&&this.consentManager.manageAmpConsentFromGoogleDomain(),this.onReadyCallbacks.forEach(this.onReady.push.bind(this))}loadDmotionLibrary(){if(!this.isDMotionLibLoaded){let e=this.getDmotionDefaultPlayerUrl(),n=document.createElement("script");n.src=e,n.onload=function(){if(i.log("%c DMOTION: DailyMotion player lib loaded",t.dev_log_customization),this.onload=this.onreadystatechange=null,t.events?.dailymotionLibReady){let e=t.events?.dailymotionLibReady;const n=new CustomEvent(e,{bubbles:!0});document.dispatchEvent(n),i.log("%c DMOTION:  ueDailyMotion ready event dispatched",t.dev_log_customization)}},(document.getElementsByTagName("head")[0]||document.body).appendChild(n),this.isDMotionLibLoaded=!0}}getDmotionDefaultPlayerUrl(){if(this.config.players&&Object.keys(this.config.players).length>0){let e;if(e=this.config.defaultPlayerSettings?.defaultLibPlayerId?this.config.defaultPlayerSettings?.defaultLibPlayerId:Object.keys(this.config.players)[0],t.dmotionLibUrl){if(!e)throw new Error("[Dmotion] Error in configuration. No playerId found for player "+e);return this.defaultPlayerId=e,t.dmotionLibUrl+e+".js"}}throw new Error("[Dmotion] Error in configuration, no players defined")}getProcessParametersExtraAnalyticsInfo(e){let t={};return t.autoplay=this.config.defaultPlayerSettings?.autoplay,void 0!==e.autoplay&&(t.autoplay=e.autoplay),t.tags=e.tags,t}getUEPlayerName(e){let i="";return""!==t.playerNameFields&&Object.keys(t.playerNameFields).length>0&&[...t.playerNameFields].sort(((e,t)=>e.priority>=t.priority?1:-1)).forEach((t=>{e.hasOwnProperty(t.field)?e[t.field]?""===i?i=t.field:i+="_"+t.field:t.always_present&&(""===i?i="no_"+t.field:i+="_no_"+t.field):this.config.defaultPlayerSettings.hasOwnProperty(t.field)&&this.config.defaultPlayerSettings[t.field]?""===i?i=t.field:i+="_"+t.field:t.always_present&&(""===i?i="no_"+t.field:i+="_no_"+t.field)})),i}async processConfigParameters(e,n,o){let a={};if(!e.video)throw new Error("Error no video specified");if(a.video=e.video,e.extra&&"object"==typeof e.extra)for(let t in e.extra)a[t]=e.extra[t];if(this.config.rules&&Object.keys(this.config.rules).length>0&&this.config.rules.onlyOneAutoplay&&(this.checkOnlyOneAutoplay(e)||(e.autoplay=!1,i.log("%c DMOTION regla checkOnlyOneAutoplay activada, quitando autoplay al video "+e.video,"color:tomato;background:#d9f929"))),e.autoplay&&e.frequency){let t=o||"";e.autoplayFrequency={...this.config.autoplayFrequency},e.frequencyNumber&&"number"==typeof e.frequencyNumber&&e.frequencyNumber>0&&e.frequencyNumber<10&&(e.autoplayFrequency.maxCount=e.frequencyNumber),this.frequencyManager.checkAllowedAutoplayFrequency(e.video,e,t)||(e.autoplay=!1,e.mute=!1)}let s=this.getUEPlayerName(e);i.log("%c DMOTION PLAYER NAME "+s,"color:tomato;background:#d9f929");let r,d=this.config.players[s];return d&&(a.player=d),e.playlist&&(a.playlist=e.playlist),a.params=a.params||{},e.loop&&(a.params.loop=e.loop),e.mute?a.params.mute=e.mute:this.config.defaultMute&&(a.params.mute=this.config.defaultMute),e.startTime&&(a.params.startTime=e.startTime),e.scaleMode&&-1!==t.scaleMode?.indexOf(e.scaleMode)&&(a.params.scaleMode=e.scaleMode),n&&(n.setAdvConfig(e),e.section&&n.setSection(e.section),e.tags&&n.setTags(e.tags),e.topic&&n.setTopic(e.topic),e.specialFormat&&n.setSpecialFormat(e.specialFormat),r=await n._processPublicidad(this.config?.manageConsent)),a.params.customConfig=r,a}processEventParameters(e){let i={};if(t.events?.allowedEventListeners&&"object"==typeof e.events&&Object.keys(e.events).length>0)for(let n=0;n<Object.keys(e.events).length;n++){let o=Object.keys(e.events)[n];-1!==t.events?.allowedEventListeners.indexOf(o)&&(i[o]=e.events[o])}return i}async loadVideo(e,n){(this.consentManager.isConsentManaged()||this.consentManager.isConsentManagedAmpForAdvertisement())&&await this.consentManager.checkUserInteractConsent();let a=new o(this.config?.advertisement,this.consentManager),s=await this.processConfigParameters(n,a,e),r={};r.eventsOptions=this.processEventParameters(n),r.infoVideo=this.getProcessParametersExtraAnalyticsInfo(n),this.isDMotionLibLoaded&&window.dailymotion&&"function"==typeof window.dailymotion.createPlayer?(i.log("%c DMOTION: dmotion video library loaded and ready to load  the video",t.dev_log_customization),this.loadRealVideo(e,s,a,r)):(i.log("%c DMOTION: dmotion video library NOT loaded. Waiting for ueDmotionReady event before loading video",t.dev_log_customization),document.addEventListener(t.events?.dailymotionLibReady,(()=>{i.log("%c DMOTION: ueDMotionReady event received. dmotion video library loaded and prepared to load videos",t.dev_log_customization),this.loadRealVideo(e,s,a,r)})))}loadRealVideo(e,n,o,a){if(!e)throw new Error("[Dmotion] divId neccesary to load a video");i.log("%c DMOTION: loading video in "+e,t.dev_log_customization),i.log("%c DMOTION:  video params "+JSON.stringify(n),t.dev_log_customization),Promise.all([dailymotion.createPlayer(e,n),o.manageGDPRAmazonPreBid()]).then((async s=>{let r=s[0],d=await r.getState(),l=o.getDmotionAdConfig(d);r.setCustomConfig(l),i.log("%c DMOTION: PUBLI SETEADA"+JSON.stringify(l)+"date:"+new Date,t.dev_log_customization),this.eventsManager.setUpDmotionAnalytics(r,e,a.infoVideo),this.eventsManager.setDMotionDynamicPrebid(r,o,n),this.eventsManager.setEventsCallbacks(r,a.eventsOptions)})).catch((e=>{i.log("%c DMOTION: ERROR CREATEPLAYER "+e,t.dev_log_customization)}))}checkOnlyOneAutoplay(e){return!e.autoplay||!this.autoplayActivated&&(this.autoplayActivated=!0,!0)}}const l=window.kalturaPlayerConfig||{};class c{constructor(){}Player=class{sections;topic;tags;container;kalturaConfig;constructor(e,t){this.container=e,this.config=t,this.sections="",this.topic="",this.tags="",this.kalturaConfig={},window.kalturaPlayerConfig&&(this.kalturaConfig=window.kalturaPlayerConfig)}load(t,i){if(-1!==t.indexOf("0_")){var n=new XMLHttpRequest,o=e.migrationServiceURL+t;n.open("GET",o,!0),n.setRequestHeader("Content-Type","application/json"),n.timeout=5e3,n.onreadystatechange=e=>{if(4==n.readyState)if(200==n.status)try{var o=JSON.parse(n.responseText);if("object"==typeof o&&Object.keys(o).length>0){var a;a=o&&o.hasOwnProperty("private")?o.private:o.public,this.finalLoad(a,this.container)}else this.loadKalturaVideo(t,i)}catch(e){this.loadKalturaVideo(t,i)}else 404==n.status&&this.loadKalturaVideo(t,i)},n.send()}else this.finalLoad(t,t)}loadKalturaVideo(e,t){var i=new KalturaUE_OLD.Player(this.container,l);this.tags&&i.setTags(this.tags),this.topic&&i.setTopic(this.topic),this.sections&&i.setSection(this.sections),0!==Object.keys(this.kalturaConfig).length&&i.setConfig(this.kalturaConfig),this.setNoAdv&&i.setPublicidad(!1,!1),i.load(e,t)}createNewDivInVideosDomain(e){let t=e;if(window.location.href.indexOf("videos.")){t="video_"+e;let n=document.getElementById(e);if(n){var i=document.createElement("div");i.id=t,n.appendChild(i)}}return t}finalLoad(e,t){var i={video:e,section:this.sections?this.sections:"",tags:this.tags?this.tags:"",topic:this.topic?this.topic:""};this.kalturaConfig?.opciones?.autoplay&&(i.autoplay=!0),this.setNoAdv&&(i.specialFormat=!0),window.ueDailymotion.loadVideo(t,i)}setTags(e){this.tags=e}setTopic(e){this.topic=e}setSection(e){this.sections=e}setConfig(e){this.kalturaConfig=e}setIncrementalCounter(e){}setPublicidad(e){!1===e&&(this.setNoAdv=!0)}addEvent(e,t){window.addEventListener("UEDailyMotionVideoEnd",(()=>{t()}))}};kalturaPlayer=async function(t){let i=function(e,t,i,n){var o={video:e,section:i||"",autoplay:!1};n||(o.specialFormat=!0),window.ueDailymotion.loadVideo(t,o)};if(t.videoId){let a=t.seccion?t.seccion:"",s=!0;if(!1===t.publi&&(s=!1),e.migrationServiceURL){let r="string"==typeof t.objId?t.objId:"player"+Math.ceil(1e5*Math.random()),d='<div id="'+r+'" class="player"  style="width:100%"></div>';document.write(d);var n=new XMLHttpRequest,o=e.migrationServiceURL+t.videoId;n.open("GET",o,!0),n.setRequestHeader("Content-Type","application/json"),n.timeout=5e3,n.onreadystatechange=function(e){if(4==n.readyState)if(200==n.status)try{var o,d=JSON.parse(n.responseText);o=d&&d.hasOwnProperty("private")?d.private:d.public,i(o,r,a,s)}catch(e){}else if(404==n.status){let e="string"==typeof t.objId?t.objId:"player"+Math.ceil(1e5*Math.random()),n='<div id="'+e+'" class="player"  style="width:100%"></div>';document.write(n),i(t.videoId,e,a,s)}},n.send()}else{let e="string"==typeof t.objId?t.objId:"player"+Math.ceil(1e5*Math.random()),n='<div id="'+e+'" class="player"  style="width:100%"></div>';document.write(n),i(t.videoId,e,a,s)}}}}if(window.ueDailymotion)console.log("DMOTION: Warning libreria dailymotion ya cargada");else{const t=window.onUEDailymotionReady||[];window.ueDailymotion=new d(t),window.onUEDailymotionReady=window.ueDailymotion.onReady,window.ueDailymotion.init();const i=new CustomEvent("ueDailymotion");document.dispatchEvent(i),e.hasOwnProperty("migrationActive")&&!0===e.migrationActive&&(window.KalturaUE_OLD=window.KalturaUE||{},window.kalturaPlayerConfig=l,window.KalturaUE=new c,window.kalturaPlayer=window.KalturaUE.kalturaPlayer)}})();