if (typeof _apw !== 'undefined') {(function(b,a,c){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(g,f){if(f===null){f=0}else{if(f<0){f=Math.max(0,this.length+f)}}for(var e=f,d=this.length;e<d;e++){if(this[e]===g){return e}}return -1}}_apw.modules.std={update:function(){},reset:function(){var d=a.createElement("img");d.src="//"+_apw.settings.base_domain+"/apw/api/v1/reset.gif";a.body.appendChild(d)},decode_base64url_nopad:function(j){var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var e=(4-j.length%4);for(var f=0;f<e;f++){j+="="}var n="";var l,k,h,g;for(var f=0;f<j.length-3;f+=4){l=m.indexOf(j.charAt(f+0));k=m.indexOf(j.charAt(f+1));h=m.indexOf(j.charAt(f+2));g=m.indexOf(j.charAt(f+3));n+=String.fromCharCode((l<<2)|(k>>>4));if(j.charAt(f+2)!="="){n+=String.fromCharCode(((k<<4)&240)|((h>>>2)&15))}if(j.charAt(f+3)!="="){n+=String.fromCharCode(((h<<6)&192)|g)}}return n},get_cookie:function(e){var d=a.cookie.split(/;\s*/);e+="=";for(var f=d.length-1;f>=0;f--){if(!d[f].indexOf(e)){return d[f].replace(e,"")}}return null},get_cookies:function(g){var d={};var e=a.cookie.split(/;\s*/);for(var f=e.length-1;f>=0;f--){var h=/^([^=]*)=(.*)$/.exec(e[f]);if(h){if(g.test(h[1])){d[h[1]]=h[2]}}}return d},set_cookie:function(e,g,d){var f=e+"="+g+"; domain=."+_apw.settings.cookie_domain+"; path=/";if(d!==c){f+="; expires="+new Date(d*1000).toGMTString()}if(_apw.settings.cookies.flags!=""){f+="; "+_apw.settings.cookies.flags}a.cookie=f},delete_cookie:function(d){_apw.modules.std.set_cookie(d,"",0)}}})(window,document);(function(d,a,f){var e={meters:{},interval:null};function c(g,i){var h=/^(\d+)\.[a-zA-Z0-9-_]+\.(\d+)\.(.*)\..+$/.exec(i);if(h!==null){try{return{name:g,value:i,expiration:parseInt(h[1],10),used_quota:parseInt(h[2],10),history:h[3]}}catch(j){return null}}else{return null}}function b(j,g,m){var h;if(g=="timestamped"){h=_apw.modules.std.decode_base64url_nopad(j)}else{h=j}var l=[];var k,i;if(g=="plain"){if(m){k=/([^|]+)/g;while((i=k.exec(h))!==null){l.push({id:i[1],timestamp:null,credits:1})}}else{k=/([^|,]+),([0-9]+)/g;while((i=k.exec(h))!==null){l.push({id:i[1],timestamp:null,credits:parseInt(i[2],10)})}}}else{if(g=="timestamped"){if(m){k=/\(([^|,]+),([0-9]+)\)/g;while((i=k.exec(h))!==null){l.push({id:i[1],timestamp:parseInt(i[2],10),credits:1})}}else{k=/\(([^|,]+),([0-9]+),([0-9]+)\)/g;while((i=k.exec(h))!==null){l.push({id:i[1],timestamp:parseInt(i[2],10),credits:parseInt(i[3],10)})}}}}return l}_apw.modules.meters={update:function(){var q=/^apw_(exc|aac)_[a-zA-Z0-9-_]+$/;var n={};var g,j,o,k,l;var p=_apw.modules.std.get_cookies(q);for(g in p){if(p.hasOwnProperty(g)){j=c(g,p[g]);if(j!==null){n[j.name]=j}else{_apw.modules.std.delete_cookie(j.name)}}}var h=[];try{for(l=0;l<localStorage.length;l++){g=localStorage.key(l);if(q.test(g)){if(!n.hasOwnProperty(g)){j=c(g,localStorage[g]);if(j!==null){n[j.name]=j;h.push(j)}else{localStorage.removeItem(g)}}}}}catch(m){}o=d.name.split(";");if(o.shift()==_apw.settings.cookie_domain){for(l=o.length-1;l>=0;l--){k=/^([^=]*)=(.*)$/.exec(o[l]);if(k){if(q.test(k[1])){if(!n.hasOwnProperty(k[1])){j=c(k[1],k[2]);if(j!==null){n[j.name]=j;h.push(j)}}}}}}for(l=0;l<h.length;l++){j=h[l];_apw.modules.std.set_cookie(j.name,j.value,j.expiration)}o=[];for(g in n){if(n.hasOwnProperty(g)){j=n[g];try{localStorage[j.name]=j.value}catch(m){}o.push(j.name+"="+j.value)}}if(o.length>0){o.unshift(_apw.settings.cookie_domain);d.name=o.join(";")}for(g in n){if(n.hasOwnProperty(g)){j=n[g];e.meters[j.name]={expiration:j.expiration,used_quota:j.used_quota,history:j.history}}}if(e.interval){clearInterval(e.interval)}e.interval=setInterval(_apw.modules.meters.update,2000)},get:function(k,n,h,m){var g=null;var j="apw_"+k+"_"+n;if(e.meters.hasOwnProperty(j)){var l=e.meters[j];var i=Math.round(new Date().getTime()/1000);if(i<l.expiration){g={expiration:l.expiration,used_quota:l.used_quota,history:b(l.history,h,m)}}}return g}}})(window,document);(function(b,a,c){_apw.modules.anonymous_ac={update:function(){},get:function(e){var f=_apw.settings.anonymous_ac.fallback;if(e in _apw.settings.anonymous_ac.pids){f=_apw.settings.anonymous_ac.pids[e]}var d={pid:e,quota:f.quota,used:0,history:[],available:f.quota,expiration:Math.max(f.period.end-Math.round(new Date().getTime()/1000),0)};var g=_apw.modules.meters.get("aac",e,f.history_type,f.ignore_credits);if(g!==null){d.used=g.used_quota;d.history=g.history;d.available=d.quota-d.used;d.expiration=Math.max(g.expiration-Math.round(new Date().getTime()/1000),0)}return d}}})(window,document);(function(c,a,e){var d={name:"apw_subs"};var b=function(f){this.get=function(){return f};this.subscribed=function(g){var h=parseInt(Date.now()/1000);for(var j in f.allowed){if(f.allowed.hasOwnProperty(j)){var i=f.allowed[j];if((i.exp>h)&&(i.pids.indexOf(g)>=0)){return true}}}return false};this.serialize=function(){try{return JSON.stringify(f)}catch(g){return null}}};b.deserialize=function(g){try{return new b(JSON.parse(g))}catch(f){return null}};_apw.modules.subscribers_ac={update:function(){},reset:function(){_apw.modules.std.reset()},load:function(m,g){var f=null;if(!g){var h=_apw.modules.std.get_cookie(d.name);if(h!==null){var i=/^(\d+)\.(.+)$/.exec(h);if(i!==null){try{var k=parseInt(i[1],10);if(k>Date.now()-_apw.settings.subscribers_ac.cookie_subs_ttl*1000){f=b.deserialize(decodeURIComponent(i[2]))}}catch(j){}}}}if(f!==null){m(f)}else{var n="__apw_sac"+Math.floor(Math.random()*1000000);c[n]=function(o){delete c[n];var q=new b(o);var p=q.serialize();if((p!==null)&&(p.length<=_apw.settings.subscribers_ac.max_cookie_size)){_apw.modules.std.set_cookie(d.name,Date.now()+"."+encodeURIComponent(p))}else{_apw.modules.std.delete_cookie(d.name)}m(q)};var l=a.createElement("script");l.type="text/javascript";l.src="//"+_apw.settings.base_domain+"/apw/api/v1/subscriptions/?callback="+n;a.head.appendChild(l)}}}})(window,document);(function(b,a,d){var c=["std","meters","anonymous_ac","subscribers_ac"];_apw.update=function(){try{for(var f=0;f<c.length;f++){if(c[f] in _apw.modules){_apw.modules[c[f]].update()}}_apw.reset=function(){_apw.modules.std.reset()}}catch(g){if(console!==d&&console!==null){console.log("Failed to set APW state: "+g)}}};_apw.update()})(window,document);}