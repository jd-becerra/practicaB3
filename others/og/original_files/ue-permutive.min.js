!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["ue-permutive"]=t():e.uePermutive=t()}(window,(function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";i.r(t),i.d(t,"uePermutive",(function(){return gt}));const n=Object.freeze({USER_ADOBE_ID:"s_fid",USER_GOOGLE_ANALYTICS_ID:"_ga",USER_PIANO_VISITOR_ID:"__pvi"}),o=Object.freeze({SITE_VERSION:"be_page_site_version",CONTENT_DOMAIN:"be_page_domain",CONTENT_SUBDOMAIN:"be_page_subdomain",CONTENT_SECTION:"be_page_section",CONTENT_SUBSECTION1:"be_page_subsection1",CONTENT_TYPE:"be_page_content_type",ARTICLE_NEWS_ID:"be_page_newsID",ARTICLE_KEYWORDS:"be_text_seoTags",ARTICLE_TYPE_PREMIUM:"be_content_premium",ARTICLE_TYPE_SIGNWALL:"be_content_signwall",USER_PROFESION:"userProfesion",USER_CATEGORY:"userCategory",USER_PRESCRIPTOR:"userPrescriptor",ARTICLE_IAB_SEGMENT:"undefined",ARTICLE_IAB_TAXONOMY:"iab_taxonomies",USER_TYPE:"undefined",USER_REGION:"undefined",BEHAVIOUR_VIEW_PAGES:"undefined",BEHAVIOUR_AVG_SERVED:"undefined",BEHAVIOUR_AVG_VIEWED:"undefined",BEHAVIOUR_AVG_CLICKED:"undefined",BEHAVIOUR_AD_CONSUMER:"undefined",IS_PREMIUM:"isPremium",LOGIN_STATUS:"login_status",USER_NIL:"user_nil_id",USER_EMAIL_SHA:"user_email_sha256"}),r=Object.freeze({LOGGED:"logged",NOT_LOGGED:"not logged"}),s=Object.freeze({FALSY_REQUIRED_ARGUMENT:"A required argument is falsy.",INVALID_REQUIRED_ARGUMENT:"A required argument is not valid.",INVALID_TYPE_REQUIRED_ARGUMENT:"A required argument type is not valid.",UNEXPECTED_VALUE:"A value provided is not valid."}),a=Object.freeze({PERMUTIVE_IAB_ID:361}),u=Object.freeze({"www.elmundo.es":{cookie:"REGMUNDO",cxPrefix:"une",pid:"5"},"seguro.elmundo.es":{cookie:"REGMUNDO",cxPrefix:"une",pid:"5"},"www.marca.com":{cookie:["REGMARCA","REGMARCAMEXICO"]},"seguro.marca.com":{cookie:"REGMARCA"},"seguro-mx.marca.com":{cookie:"REGMARCAMEXICO"},"co.marca.com":{cookie:"REGMARCACOLOMBIA"},"seguro-co.marca.com":{cookie:"REGMARCACOLOMBIA"},"us.marca.com":{cookie:"REGMARCA"},"seguro-us.marca.com":{cookie:"REGMARCAUSA"},"ar.marca.com":{cookie:"REGMARCAARGENTINA"},"seguro-ar.marca.com":{cookie:"REGMARCAARGENTINA"},"www.telva.com":{cookie:"REGTELVA"},"seguro.telva.com":{cookie:"REGTELVA"},"www.expansion.com":{cookie:"expansionID",cxPrefix:"unx",pid:"9"},"seguro.expansion.com":{cookie:"expansionID",cxPrefix:"unx",pid:"9"}}),c=Object.freeze({PREMIUM:"PREMIUM",SIGNED:"SIGNED",FREE:"FREE"}),l=Object.freeze({EUCONSENT:"euconsent-v2",JWT:"uejwt",PERMUTIVE_CONSENT:"permutive-consent",PERMUTIVE_DATA:"permutive-data",PERMUTIVE_DATA_MISC:"permutive-data-misc",PERMUTIVE_ID:"permutive-id",SUSCRIPTOR:"suscriptor",UE_PERMUTIVE_CONSENT_STATUS:"ue-permutive-consent-status"}),d=Object.freeze({MS_MAX_WAIT:3e4}),h=Object.freeze({UERegistro:3,DMUERegistro:2,AdobeAnalytics:5,GoogleAnalytics:1,PianoID:4,UEHID:0,mtid:0});function v(e){this.message=e}v.prototype=new Error,v.prototype.name="InvalidCharacterError";var g="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new v("'atob' failed: The string to be decoded is not correctly encoded.");for(var i,n,o=0,r=0,s="";n=t.charAt(r++);~n&&(i=o%4?64*i+n:n,o++%4)?s+=String.fromCharCode(255&i>>(-2*o&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return s};function m(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(g(e).replace(/(.)/g,(function(e,t){var i=t.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i})))}(t)}catch(e){return g(t)}}function w(e){this.message=e}w.prototype=new Error,w.prototype.name="InvalidTokenError";var f=function(e,t){if("string"!=typeof e)throw new w("Invalid token specified");var i=!0===(t=t||{}).header?0:1;try{return JSON.parse(m(e.split(".")[i]))}catch(e){throw new w("Invalid token specified: "+e.message)}};var E=(()=>{var e,t;const i=(null===(e=window.localStorage)||void 0===e?void 0:e.getItem("ue-dcv"))||(null===(t=window.localStorage)||void 0===t?void 0:t.getItem("ue-dcv-permutive"))||!1,n={};if(["debug","error","info","log","warn","dir","dirxml","table","trace","group","groupCollapsed","groupEnd","clear","count","countReset","assert","profile","profileEnd","time","timeLog","timeEnd","timeStamp","context","memory"].forEach(e=>{n[e]=window.console[e]||function(){}}),i)return n;return Object.keys(console).forEach(e=>n[e]=()=>{}),n})();function p(e,t){_(e,t),t.add(e)}function I(e,t,i){_(e,t),t.set(e,i)}function _(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function A(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function P(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,b(e,t,"set"),i),i}function S(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,b(e,t,"get"))}function b(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function T(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}var y=new WeakMap,R=new WeakMap,C=new WeakMap,M=new WeakSet,O=new WeakSet,N=new WeakSet,U=new WeakSet,k=new WeakSet,D=new WeakSet,L=new WeakSet;class W{constructor(){if(p(this,L),p(this,D),p(this,k),p(this,U),p(this,N),p(this,O),p(this,M),A(this,"adobeId",null),A(this,"googleId",null),A(this,"hid",null),A(this,"isLogged",!1),A(this,"jwt",null),A(this,"NIL",null),A(this,"pianoId",null),I(this,y,{writable:!0,value:u[window.location.hostname]}),I(this,R,{writable:!0,value:void 0}),I(this,C,{writable:!0,value:void 0}),this.constructor.instance)return this.constructor.instance;E.count("[Permutive] Account constructor"),this.constructor.instance=this;const{isLogged:e,uid:t,jwt:i}=T(this,D,Y).call(this);this.isLogged=e,this.NIL=t,this.JWT=i}getUserInfo(){if(!this.JWT)return{};const{birth_date:e,gender:t}=f(this.JWT);return{birthdateYear:new Date(e).getFullYear(),gender:t}}getPremiumInfo(){return E.count("[Permutive] Account getPremiumInfo"),new Promise(e=>{var t;if(S(this,C)&&(clearTimeout(S(this,C)),P(this,C,null)),!this.isLogged)return void e({});const i=sessionStorage.getItem(l.SUSCRIPTOR);if(i)try{const t=JSON.parse(i);if(!0===(null==t?void 0:t.isLogged))return t.subscriptions=t.subscriptionPortals,E.count("[Permutive] Account getPremiumInfo: storage found"),void e(t)}catch(e){E.error("[Permutive] Account getPremiumInfo: An error has occurred while parsing the stored suscriptor info. We will try to get the info from ueLoginPremium.",e)}if("function"==typeof(null===(t=window.ueLoginPremium)||void 0===t?void 0:t.update))return E.count("[Permutive] Account getPremiumInfo: ueLoginPremium ready"),void e(window.ueLoginPremium.update());if(E.count("[Permutive] Account getPremiumInfo: ueLoginPremium not ready"),S(this,R)||"loading"!==document.readyState)return void e({});E.time("[Permutive] Account getPremiumInfo: waiting to ueLoginPremium"),P(this,C,setTimeout(()=>{E.count("[Permutive] Account getPremiumInfo: ue-loginpremium-ready not fired and timeout reached"),P(this,C,null),P(this,R,!0),e({})},d.MS_MAX_WAIT));const n=t=>{E.count("[Permutive] Account getPremiumInfo: "+t+" fired"),S(this,R)||(E.timeEnd("[Permutive] Account getPremiumInfo: waiting to ueLoginPremium"),P(this,R,!0),e(this.update()))};"loading"===document.readyState&&document.addEventListener("DOMContentLoaded",n.bind(this,"DOMContentLoaded")),document.addEventListener("ue-loginpremium-ready",n.bind(this,"ue-loginpremium-ready"))})}update3rdPartyIds(){E.count("[Permutive] Account update3rdPartyIds"),this.isLogged&&(this.adobeId=T(this,M,G).call(this),this.hid=T(this,U,x).call(this)),this.googleId=T(this,N,j).call(this),this.pianoId=T(this,k,B).call(this)}}function G(){return E.count("[Permutive] Account #getAdobeId"),T(this,O,V).call(this,n.USER_ADOBE_ID)}function V(e){let t=e;Array.isArray(e)&&(t=e.find(e=>document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)")));const i=document.cookie.match("(^|;) ?"+t+"=([^;]*)(;|$)");return i?i[2]:null}function j(){E.count("[Permutive] Account #getGoogleId");const e=T(this,O,V).call(this,n.USER_GOOGLE_ANALYTICS_ID);if(e){var t=e.split(".");if(t.length>=3)return t[2]+"."+t[3]}return null}function x(){E.count("[Permutive] Account #getHid");if(!this.JWT)return null;const{hid:e}=f(this.JWT);return e||null}function B(){const e=T(this,O,V).call(this,n.USER_PIANO_VISITOR_ID);if(!e)return null;try{return JSON.parse(decodeURIComponent(e)).id}catch(e){return E.warn("[Permutive] Account #getPianoId: An error has occured while parsing `__pvi` cookie value."),null}}function Y(){var e;if(E.count("[Permutive] Account getInfoFromCookie"),null===(e=S(this,y))||void 0===e||!e.cookie)return{};const t=T(this,O,V).call(this,S(this,y).cookie),i=Boolean(t);return{isLogged:i,uid:T(this,L,z).call(this,t,i),jwt:localStorage.getItem(l.JWT)}}function z(e,t){var i,n,o,r;if(!e||!t)return null;const s=null===(i=window._apw)||void 0===i||null===(n=i.settings)||void 0===n||null===(o=n.payload)||void 0===o||null===(r=o.user)||void 0===r?void 0:r.uid;if(s)return s;if(!new RegExp("[0-9a-zA-Z]+-(?:[a-zA-Z0-9+/]{4})*(?:|(?:[a-zA-Z0-9+/]{3}=)|(?:[a-zA-Z0-9+/]{2}==)|(?:[a-zA-Z0-9+/]{1}===))$").test(unescape(e)))return null;const a=new RegExp("^([0-9a-zA-Z]+)-").exec(e);return(a instanceof Array&&a[1]?String(parseInt("0x"+a[1])):void 0)||null}A(W,"instance",void 0);var H=W;function F(e,t){K(e,t),t.add(e)}function J(e,t,i){K(e,t),t.set(e,i)}function K(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function q(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function X(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,Q(e,t,"set"),i),i}function Z(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}function $(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Q(e,t,"get"))}function Q(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}var ee=new WeakMap,te=new WeakMap,ie=new WeakMap,ne=new WeakMap,oe=new WeakMap,re=new WeakMap,se=new WeakMap,ae=new WeakMap,ue=new WeakMap,ce=new WeakSet,le=new WeakSet,de=new WeakSet,he=new WeakSet,ve=new WeakSet,ge=new WeakSet,me=new WeakSet,we=new WeakSet;class fe{get articleKeywords(){return $(this,ee)}set articleKeywords(e){const t=Z(this,le,pe).call(this,e);X(this,ee,t instanceof Array?t.filter(e=>!/^\s*$/gim.test(e)):void 0)}get articleIab_segment(){return $(this,te)}set articleIab_segment(e){X(this,te,Z(this,le,pe).call(this,e))}get articleIab_taxonomy(){return $(this,ie)}set articleIab_taxonomy(e){X(this,ie,Z(this,le,pe).call(this,e))}get userAge(){return $(this,ne)}set userAge(e){X(this,ne,Z(this,he,_e).call(this,e))}get userGender(){return $(this,oe)}set userGender(e){switch(e){case"M":X(this,oe,"H");break;case"F":X(this,oe,"M");break;default:X(this,oe,e)}}get behaviourView_pages(){return $(this,re)}set behaviourView_pages(e){X(this,re,Z(this,he,_e).call(this,e))}get behaviourAvg_served(){return $(this,se)}set behaviourAvg_served(e){X(this,se,Z(this,de,Ie).call(this,e))}get behaviourAvg_viewed(){return $(this,ae)}set behaviourAvg_viewed(e){X(this,ae,Z(this,de,Ie).call(this,e))}get behaviourAvg_clicked(){return $(this,ue)}set behaviourAvg_clicked(e){X(this,ue,Z(this,de,Ie).call(this,e))}constructor(){F(this,we),F(this,me),F(this,ge),F(this,ve),F(this,he),F(this,de),F(this,le),F(this,ce),q(this,"account",new H),q(this,"siteVersion",void 0),q(this,"contentDomain",void 0),q(this,"contentSubdomain",void 0),q(this,"contentSection",void 0),q(this,"contentSubsection1",void 0),q(this,"contentType",void 0),q(this,"articleNewsid",void 0),J(this,ee,{writable:!0,value:void 0}),q(this,"articleType",void 0),J(this,te,{writable:!0,value:void 0}),J(this,ie,{writable:!0,value:void 0}),q(this,"userType",void 0),J(this,ne,{writable:!0,value:void 0}),J(this,oe,{writable:!0,value:void 0}),q(this,"userRegion",void 0),q(this,"userCategory",void 0),q(this,"userProfesion",void 0),q(this,"userPrescriptor",void 0),J(this,re,{writable:!0,value:void 0}),J(this,se,{writable:!0,value:void 0}),J(this,ae,{writable:!0,value:void 0}),J(this,ue,{writable:!0,value:void 0}),q(this,"behaviourAd_consumer",void 0),E.count("[Permutive] DataManager constructor")}async get(){await Z(this,me,Se).call(this);const e={page:{site_version:this.siteVersion,content:{domain:this.contentDomain,subdomain:this.contentSubdomain,section:this.contentSection,subsection1:this.contentSubsection1,type:this.contentType},article:{newsid:this.articleNewsid,keywords:this.articleKeywords,type:this.articleType,iab_segment:this.articleIab_segment,iab_taxonomy:this.articleIab_taxonomy},user:{type:this.userType,age:this.userAge,gender:this.userGender,region:this.userRegion,category:this.userCategory,profesion:this.userProfesion,prescriptor:this.userPrescriptor},behaviour:{view_pages:this.behaviourView_pages,avg_served:this.behaviourAvg_served,avg_viewed:this.behaviourAvg_viewed,avg_clicked:this.behaviourAvg_clicked,ad_consumer:this.behaviourAd_consumer}}};return E.log("[Permutive] DataManager get (found result):",e),await Z(this,ce,Ee).call(this,e),E.log("[Permutive] DataManager get (clean result):",e),e}}async function Ee(e){return E.count("[Permutive] DataManager #deleteInvalidValues"),new Promise(t=>{Object.keys(e).forEach(async t=>{const i=e[t],n=Z(this,ve,Ae).call(this,i);if("object"===n)return await Z(this,ce,Ee).call(this,i),void(0===Object.keys(i).length&&delete e[t]);Z(this,ge,Pe).call(this,i,n)||delete e[t]}),t()})}function pe(e){if("string"!=typeof e)return;return e.split("|").filter(e=>e)}function Ie(e){if("string"==typeof e)try{const t=parseFloat(e);return isNaN(t)?void 0:t}catch(e){return void E.warn("[Permutive] DataManager #getFloatFromString: An error has ocurred while parsing to float the value.",e)}}function _e(e){if("number"==typeof e)return e;if("string"==typeof e)try{const t=parseInt(e);return isNaN(t)?void 0:t}catch(e){return void E.warn("[Permutive] DataManager #getIntegerFromString: An error has ocurred while parsing to an integer the value.",e)}}function Ae(e){return{}.toString.call(e).split(" ")[1].slice(0,-1).toLowerCase()}function Pe(e,t){switch(t){case"string":return""!==e;case"array":return e&&0!==e.length;case"map":case"set":return e&&0!==e.size;case"symbol":case"regexp":case"function":case"weakmap":case"weapset":case"object":case"null":case"undefined":case void 0:return!1;default:return!0}}async function Se(){E.time("[Permutive] DataManager #updateProperties");const e=window.ueDataLayer||{},t=o;this.siteVersion=e[t.SITE_VERSION],this.contentDomain=e[t.CONTENT_DOMAIN],this.contentSubdomain=e[t.CONTENT_SUBDOMAIN],this.contentSection=e[t.CONTENT_SECTION],this.contentSubsection1=e[t.CONTENT_SUBSECTION1],this.contentType=e[t.CONTENT_TYPE],this.articleNewsid=e[t.ARTICLE_NEWS_ID],this.articleKeywords=e[t.ARTICLE_KEYWORDS],this.articleType="1"===e[t.ARTICLE_TYPE_PREMIUM]?"PREMIUM":"1"===e[t.ARTICLE_TYPE_SIGNWALL]?"SIGNWALL":"FREE",this.articleIab_taxonomy=e[t.ARTICLE_IAB_TAXONOMY],this.userCategory=e[t.USER_CATEGORY],this.userProfesion=e[t.USER_PROFESION],this.userPrescriptor=e[t.USER_PRESCRIPTOR];const i=await Z(this,we,be).call(this),{birthdateYear:n,gender:r}=this.account.getUserInfo();this.userType=i,this.userAge=n,this.userGender=r,this.userNil=e[t.USER_NIL],this.userEmailSHA=e[t.USER_EMAIL_SHA],this.articleIab_segment=e[t.ARTICLE_IAB_SEGMENT],this.userRegion=e[t.USER_REGION],this.behaviourView_pages=e[t.BEHAVIOUR_VIEW_PAGES],this.behaviourAvg_served=e[t.BEHAVIOUR_AVG_SERVED],this.behaviourAvg_viewed=e[t.BEHAVIOUR_AVG_VIEWED],this.behaviourAvg_clicked=e[t.BEHAVIOUR_AVG_CLICKED],this.behaviourAd_consumer=e[t.BEHAVIOUR_AD_CONSUMER],E.timeEnd("[Permutive] DataManager #updateProperties")}async function be(){E.count("[Permutive] DataManager #getUserType");const e=window.ueDataLayer||{},t=o,i=this.account.isLogged&&e[t.IS_PREMIUM];switch(this.account.isLogged&&e[t.LOGIN_STATUS]){case r.LOGGED:return i?c.PREMIUM:c.SIGNED;case r.NOT_LOGGED:return c.FREE;case void 0:default:{const e=await this.account.getPremiumInfo();return e.isPremium?c.PREMIUM:e.isLogged||this.account.isLogged?c.SIGNED:c.FREE}}}function Te(e,t){ye(e,t),t.add(e)}function ye(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Re(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Ce(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,function(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}(e,t,"get"))}function Me(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}var Oe,Ne,Ue=new WeakMap,ke=new WeakSet,De=new WeakSet,Le=new WeakSet,We=new WeakSet,Ge=new WeakSet,Ve=new WeakSet,je=new WeakSet,xe=new WeakSet,Be=new WeakSet,Ye=new WeakSet,ze=new WeakSet,He=new WeakSet,Fe=new WeakSet,Je=new WeakSet,Ke=new WeakSet,qe=new WeakSet,Xe=new WeakSet;function Ze(e){var t;E.log("[Permutive] PermutiveController #addOnPermutive: Data is:",e),null===(t=window.permutive)||void 0===t||t.addon("web",e)}async function $e(){return await this.dataManager.get()}function Qe(){E.count("[Permutive] PermutiveController #bindEvents");const e=async()=>{E.count("[Permutive]  PermutiveController #bindEvents: onDomLoaded");const e=await Me(this,De,$e).call(this);Me(this,He,ut).call(this),Me(this,qe,ht).call(this),Me(this,Ye,st).call(this),Me(this,ke,Ze).call(this,e),Me(this,Xe,vt).call(this)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e.bind(this)):e(),document.addEventListener("nc-urlChanged",async()=>{E.count("[Permutive]  PermutiveController #bindEvents: nc-urlChanged");const e=await Me(this,De,$e).call(this);Me(this,ke,Ze).call(this,e)}),document.addEventListener("@ue-content-updated",async()=>{E.count("[Permutive]  PermutiveController #bindEvents: @ue-content-updated");const e=await Me(this,De,$e).call(this);Me(this,ke,Ze).call(this,e)}),window.addEventListener("storage",e=>{/permutive/gim.test(e.key)&&(E.count("[Permutive]  PermutiveController #bindEvents: permutive storage"),Me(this,Be,rt).call(this,"@permutive-storage",50,Me(this,He,ut).bind(this),this))}),window.didomiEventListeners.push({event:"consent.changed",listener:()=>{var e;null===(e=window.localStorage)||void 0===e||e.removeItem(l.UE_PERMUTIVE_CONSENT_STATUS),Me(this,Xe,vt).call(this)}})}function et(){E.count("[Permutive] PermutiveController #build"),function(e,t,i,n,o){if(!t){t=t||{},window.permutive=t,t.q=[],t.config=o||{},t.config.projectId=i,t.config.apiKey=n,t.config.environment=t.config.environment||"production";for(var r=["addon","identify","track","trigger","query","segment","segments","ready","on","once","user","consent"],s=0;s<r.length;s++){var a=r[s];t[a]=function(e){return function(){var i=Array.prototype.slice.call(arguments,0);t.q.push({functionName:e,arguments:i})}}(a)}}}(document,window.permutive,this.projectId,this.publicApiKey,this.buildOptions),window.googletag.cmd.push((function(){if(0===window.googletag.pubads().getTargeting("permutive").length){E.log('[Permutive] PermutiveController #build: get stored "_pdfps"');var e=window.localStorage.getItem("_pdfps");window.googletag.pubads().setTargeting("permutive",e?JSON.parse(e):[])}}))}function tt(e,t){var i,n;const o=null!=t&&(void 0===(null===(i=this.storedDataMisc.aliases)||void 0===i?void 0:i[e])||(null===(n=this.storedDataMisc.aliases)||void 0===n?void 0:n[e])!==t);return E.log("[Permutive] PermutiveController #checkAlias",e,t,o),o}function it(){return E.count("[Permutive] PermutiveController #getPermutiveConsentStatus"),new Promise(e=>{var t;const i=null===(t=window.localStorage)||void 0===t?void 0:t.getItem(l.UE_PERMUTIVE_CONSENT_STATUS);if(i){const t=JSON.parse(i);return void e(t)}let n=setTimeout(()=>{n=null,e(void 0)},d.MS_MAX_WAIT);window.didomiOnReady.push(()=>{var t,i,o;let r;var s,u,c;(n&&(clearTimeout(n),n=null),r=null===(t=window.ueCookiesPolicy)||void 0===t||null===(i=t.getUserConsentStatusForVendors)||void 0===i||null===(o=i.call(t,a.PERMUTIVE_IAB_ID))||void 0===o?void 0:o[a.PERMUTIVE_IAB_ID],"boolean"!==r)&&(r=null===(s=(u=window.Didomi).getUserStatusForVendor)||void 0===s?void 0:s.call(u,a.PERMUTIVE_IAB_ID));if("boolean"==typeof r)return null===(c=window.localStorage)||void 0===c||c.setItem(l.UE_PERMUTIVE_CONSENT_STATUS,String(r)),void e(r);e(void 0)})})}function nt(){return E.count("[Permutive] PermutiveController #getToken"),new Promise(e=>{var t,i,n;const o=(null===(t=window.ueCookiesPolicy)||void 0===t||null===(i=t.getConsentData)||void 0===i?void 0:i.call(t))||(null===(n=window.localStorage)||void 0===n?void 0:n.getItem(l.EUCONSENT));if(o)return void e(o);let r=setTimeout(()=>{r=null,e(void 0)},d.MS_MAX_WAIT);window.didomiOnReady.push(()=>{r&&(clearTimeout(r),r=null)});let s=setTimeout(()=>{clearTimeout(s),s=null,"function"==typeof window.__tcfapi&&window.__tcfapi("getTCData",2,(function(t,i){if(i&&t){const i=t.tcString;e(i)}}))},5e3)})}function ot(){E.count("[Permutive] PermutiveController #init3thParty"),window.didomiOnReady=window.didomiOnReady||[],window.didomiEventListeners=window.didomiEventListeners||[],window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],window.Utiq=window.Utiq||{}}function rt(e,t,i,n){if(Ce(this,Ue).has(e)&&(clearTimeout(Ce(this,Ue).get(e)),Ce(this,Ue).set(e,null)),"function"==typeof i){const o=setTimeout(()=>{n?i.apply(n):i(),Ce(this,Ue).set(e,null)},t);Ce(this,Ue).set(e,o)}}function st(){var e;const t=Object.keys(this.aliases).filter(e=>Me(this,Ge,tt).call(this,e,this.aliases[e])).map(e=>({id:this.aliases[e],tag:e,priority:h[e]}));E.log("[Permutive] PermutiveController #sendAliases (found / sent): ",this.aliases,t),null===(e=window.permutive)||void 0===e||e.identify(t)}async function at(){var e;if(E.log("[Permutive] PermutiveController #sendConsent (this.consent):",this.consent),"function"!=typeof(null===(e=window.permutive)||void 0===e?void 0:e.consent))throw E.error("[Permutive] PermutiveController #sendConsent: window.permutive.consent is not a function"),new Error(s.UNEXPECTED_VALUE);void 0!==this.consent.status?this.consent.status!==this.storedConsent.opt_in||!1!==this.consent.status&&this.consent.token!==this.storedConsent.token?this.consent.status&&void 0!==this.consent.token?window.permutive.consent({opt_in:!0,token:this.consent.token}):window.permutive.consent({opt_in:!1}):E.log("[Permutive] PermutiveController #sendConsent: status and token did not change so won't be sent"):E.warn("[Permutive] PermutiveController #sendConsent: status is undefined so will not be sent")}function ut(){E.count("[Permutive] PermutiveController #setPermutiveStoredInfo");try{var e,t,i;const n=null===(e=window.localStorage)||void 0===e?void 0:e.getItem(l.PERMUTIVE_CONSENT),o=null===(t=window.localStorage)||void 0===t?void 0:t.getItem(l.PERMUTIVE_DATA_MISC),r=null===(i=window.localStorage)||void 0===i?void 0:i.getItem(l.PERMUTIVE_ID);this.storedId=r||void 0,this.storedDataMisc=o?JSON.parse(o):{},this.storedConsent=n?JSON.parse(n):{}}catch(e){E.warn("[Permutive] PermutiveController #setPermutiveStoredInfo: An error occurred while parsing Permutive stored info.",e)}E.log("[Permutive] PermutiveController #setPermutiveStoredInfo (this.storedDataMisc, this.storedConsent, this.storedId):",this.storedDataMisc,this.storedConsent,this.storedId)}function ct(){return this.dataManager&&this.dataManager.userNil&&"diariomedico.com"===this.dataManager.contentDomain?this.dataManager.userNil:null}function lt(){return this.account.hid?this.account.hid:this.dataManager&&this.dataManager.userEmailSHA&&"diariomedico.com"===this.dataManager.contentDomain&&!this.account.hid?this.dataManager.userEmailSHA:null}function dt(){try{return window.Utiq.API.getIdGraphEntry("mtid")}catch(e){return E.log("[Permutive] getIdGraphEntry API call failed. Reason:', "+e.message),null}}function ht(){this.account.update3rdPartyIds(),this.aliases={UERegistro:this.account.NIL,DMUERegistro:Me(this,Fe,ct).call(this),AdobeAnalytics:this.account.adobeId,GoogleAnalytics:this.account.googleId,PianoID:this.account.pianoId,UEHID:Me(this,Je,lt).call(this),mtid:Me(this,Ke,dt).call(this)},E.log("[Permutive] PermutiveController #storeAliases (aliases):",this.aliases);const e=Object.keys(this.aliases).filter(e=>{var t,i;return(null===(t=this.storedDataMisc.aliases)||void 0===t?void 0:t[e])&&(null===(i=this.storedDataMisc.aliases)||void 0===i?void 0:i[e])!==this.aliases[e]});if(e.length>0){var t;E.log("[Permutive] PermutiveController #storeAliases: Different values found",e),e.forEach(e=>delete this.storedDataMisc.aliases[e]);const i=JSON.stringify(this.storedDataMisc);null===(t=window.localStorage)||void 0===t||t.setItem(l.PERMUTIVE_DATA,i)}}function vt(){E.count("[Permutive] PermutiveController #updateConsent (this.consent):");try{Promise.all([Me(this,Ve,it).call(this),Me(this,je,nt).call(this)]).then(e=>{this.consent.status=e[0],this.consent.token=e[1],Me(this,ze,at).call(this)})}catch(e){E.warn("[Permutive] PermutiveController #updateConsent: An error has ocurred while getting the User Consent String: ",e)}}const gt=new class{constructor(e,t){var i,n,o;if(Te(this,Xe),Te(this,qe),Te(this,Ke),Te(this,Je),Te(this,Fe),Te(this,He),Te(this,ze),Te(this,Ye),Te(this,Be),Te(this,xe),Te(this,je),Te(this,Ve),Te(this,Ge),Te(this,We),Te(this,Le),Te(this,De),Te(this,ke),Re(this,"projectId",void 0),Re(this,"publicApiKey",void 0),Re(this,"aliases",void 0),Re(this,"account",new H),Re(this,"buildOptions",{consentRequired:!0}),Re(this,"consent",{status:void 0,token:void 0}),Re(this,"dataManager",new fe),Re(this,"storedConsent",{}),Re(this,"storedDataMisc",{}),Re(this,"storedId",""),i=this,n=Ue,o={writable:!0,value:new Map},ye(i,n),n.set(i,o),E.count("[Permutive] PermutiveController contructor"),!e||!t)throw new Error("[Permutive] The projectId and publicApiKey are not valid.");this.projectId=e,this.publicApiKey=t,Me(this,xe,ot).call(this),Me(this,We,et).call(this),Me(this,Le,Qe).call(this)}}(null===(Oe=window.uePermutiveIds)||void 0===Oe?void 0:Oe.PROJECT_ID,null===(Ne=window.uePermutiveIds)||void 0===Ne?void 0:Ne.PUBLIC_API_KEY)}]).uePermutive}));